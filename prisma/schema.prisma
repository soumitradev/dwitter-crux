datasource db {
    // could be postgresql or mysql
    provider = "postgresql"
    url      = "postgres://test:pass@localhost:5432/dev"
}

generator db {
    provider = "go run github.com/prisma/prisma-client-go"
}

model User {
    dbID           String   @default(uuid()) @id

    username       String   @unique @db.VarChar(20)
    passwordHash   String

    firstName      String   @db.VarChar(40)
    lastName       String?  @db.VarChar(40)

    email          String   @db.VarChar(100) @unique

    bio            String   @db.VarChar(160)

    dweets         Dweet[]  @relation("Dweets")

    likedDweets    Dweet[]  @relation("Likes")
    
    followerCount  Int      @default(0)
    followers      User[]   @relation("Follow")

    followingCount Int      @default(0)
    following      User[]   @relation("Follow")

    createdAt      DateTime @default(now())
}

model Dweet {
    dbID              String   @default(uuid()) @id
    dweetBody         String   @db.VarChar(240)

    ID                String   @unique @db.Char(8)

    author            User     @relation("Dweets", fields: [authorID], references: [dbID])
    authorID          String

    postedAt          DateTime @default(now())
    lastUpdatedAt     DateTime @default(now())

    likeCount         Int      @default(0)
    likeUsers         User[]   @relation("Likes")

    isReply           Boolean  @default(false)
    originalReplyID   String?
    replyTo           Dweet?   @relation("Replies", fields: [originalReplyID], references: [dbID])
    replyCount        Int      @default(0)
    replyDweets       Dweet[]  @relation("Replies")
    
    isRedweet         Boolean  @default(false)
    originalRedweetID String?
    redweetOf         Dweet?   @relation("Redweets", fields: [originalRedweetID], references: [dbID])
    redweetCount      Int      @default(0)
    redweetDweets     Dweet[]  @relation("Redweets")

    media             String[]
}